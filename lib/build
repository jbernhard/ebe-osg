#!/bin/bash


# store this for later
STARTDIR=$PWD

# temporary dir for cmake output
BUILDDIR='/tmp/ebe-osg-build'

# number of jobs = number of CPUs + 1
NJOBS=$(( `grep -c processor /proc/cpuinfo` + 1 ))

# try to load Intel compilers
. /etc/profile.d/module.sh
module load intelc/11.1_072 intelf/11.1_072

hash icpc && export CXX=icpc
hash ifort && export FC=ifort




[[ -d $BUILDDIR ]] && rm -rf $BUILDDIR

mkdir $BUILDDIR || exit 1
cd $BUILDDIR

cmake -DQUIET=ON $STARTDIR || exit 1
make -j$NJOBS || exit 1
make package || exit 1

cp -v ebe.tar.gz $STARTDIR
