#!/bin/bash


# store this for later
STARTDIR=$PWD

# temporary dir for cmake output
BUILDDIR='/dev/shm/ebe-osg-build'


# try to load Intel compilers
. /etc/profile.d/module.sh
module load intelc/11.1_072 intelf/11.1_072

hash icpc && export CXX=icpc
hash ifort && export FC=ifort


# number of processor cores
NPROC=$(grep -c processor /proc/cpuinfo)


[[ -d $BUILDDIR ]] && rm -rf $BUILDDIR

mkdir $BUILDDIR || exit 1
cd $BUILDDIR

cmake $STARTDIR || exit 1
make -j$NPROC || exit 1
make package || exit 1
#
#cp -v ebe.tar.gz $STARTDIR
